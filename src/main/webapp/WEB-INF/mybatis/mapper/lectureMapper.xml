<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lecture">
	<!-- 강의 만들기 -->
	<select id="maxLectureNum" resultType="Integer">
		SELECT IFNULL(max(lectureNum), 0) FROM lecture
	</select>
	
	<!-- 강의 생성 -->
	<insert id="insertLecture" parameterType="com.sp.teacher.lecture.Lecture">
		INSERT INTO lecture (lectureNum, tId, price, registerEnd) VALUES(#{lectureNum}, #{userId}, #{price}, #{registerEnd})
	</insert>
	
	<!-- 스터디 번호 만들기 -->
	<select id="maxStudyNum" resultType="Integer">
		SELECT IFNULL(max(studyNum), 0) FROM study
	</select>
	
	<!-- 스터디 생성 -->
	<insert id="insertStudy" parameterType="com.sp.teacher.lecture.Lecture">
		INSERT INTO study(studyNum, studyName, studyIntro, userId, studyLocation, 
								studySday, studyEday, studyImg, headcount, lectureNum)
		VALUES(#{studyNum}, #{studyName}, #{studyIntro}, #{userId}, #{studyLocation}, 
								#{studySday}, #{studyEday}, #{studyImg}, #{headcount}, #{lectureNum})
	</insert>
	
	
	<!-- 강의 리스트 가져오기 -->
	<select id="readLectureList" parameterType="com.sp.teacher.Teacher" resultType="com.sp.teacher.lecture.Lecture">
	select studyNum, studyName, studyIntro, userId, studyLocation, 
	       date_format(studySday, '%Y-%m-%d') studySday, date_format(studyEday, '%Y-%m-%d') studyEday,  
	       date_format(registerEnd, '%Y-%m-%d') registerEnd, headcount, 
	       study.lectureNum, price, ifnull(count(sId),0) attendHeadCount 
	from study join lecture ON study.lectureNum = lecture.lectureNum
	left join student ON student.lectureNum = lecture.lectureNum
	group by lectureNum
	having userid=#{userId}
	</select>
	
	<!-- 강의 카테고리 명 가져오기 -->
	<select id="readCategoryName" parameterType="Integer" resultType="String">
	select categoryName from category 
		join course on category.categoryNum = course.categoryNum
		join studycourselist s on s.courseNum = course.courseNum
		where studyNum = #{studyNum}	
	</select>
	
	
	<select id="readCourseList" parameterType="Integer" resultType="String">
	select courseName from course 
		join studycourselist s on s.courseNum = course.courseNum
		where studyNum = #{studyNum}
	</select>
</mapper>